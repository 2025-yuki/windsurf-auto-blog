name: WindSurf Auto SEO

on:
  workflow_dispatch:          # ÊâãÂãïÂÆüË°å
  schedule:
    - cron: '0 0 * * *'       # ÊØéÊó• 09:00 JST

jobs:
  run-windsurf:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash -e {0}

    steps:
    # === ‚ë† „É™„Éù„Ç∏„Éà„É™„ÇíÂèñÂæóÔºà„Çµ„Éñ„É¢„Ç∏„É•„Éº„É´Âê´„ÇÄÔºâ ===
    - uses: actions/checkout@v3
      with:
        submodules: recursive

    # === ‚ë° Python 3.11 „Çí„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó ===
    - uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    # === ‚ë¢ ‰æùÂ≠ò„É©„Ç§„Éñ„É©„É™„Çí„Ç§„É≥„Çπ„Éà„Éº„É´ ===
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip  install -r requirements.txt
        python -m pip install -e vendor/windsurf   # ‚Üê vendor Áâà WindSurf „ÇíÁ∑®ÈõÜ„É¢„Éº„Éâ„Åß

    # === ‚ë£ PYTHONPATH „Å´„Éó„É≠„Ç∏„Çß„ÇØ„Éà„É´„Éº„Éà„ÇíËøΩÂä†Ôºà‚òÖÊñ∞Ë¶èÔºâ ===
    - name: Add project root to PYTHONPATH
      run: echo "PYTHONPATH=$GITHUB_WORKSPACE:$PYTHONPATH" >> "$GITHUB_ENV"

    # === ‚ë§ WindSurf „Éë„Ç§„Éó„É©„Ç§„É≥„ÇíÂÆüË°å ===
    - name: Run WindSurf pipeline
      env:
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        GOOGLE_APPLICATION_CREDENTIALS: ${{ secrets.SA_JSON_PATH }}
        SPREADSHEET_ID: ${{ secrets.SPREADSHEET_ID }}
        WP_URL:  ${{ secrets.WP_URL }}
        WP_USER: ${{ secrets.WP_USER }}
        WP_APP_PASS: ${{ secrets.WP_APP_PASS }}
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
      run: |
        echo "üêç running WindSurf pipeline..."
        python -m vendor.windsurf run auto_seo.yaml