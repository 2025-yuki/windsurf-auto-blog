name: WindSurf Auto SEO

on:
  workflow_dispatch:           # æ‰‹å‹•å®Ÿè¡Œ
  schedule:
    - cron: '0 0 * * *'        # æ¯æ—¥ 09:00 JST

jobs:
  run-windsurf:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash -e {0}

    steps:
      # --- â‘  ãƒªãƒã‚¸ãƒˆãƒªã‚’å–å¾—ï¼ˆã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å«ã‚€ï¼‰ ---
      - uses: actions/checkout@v3
        with:
          submodules: recursive

      # --- â‘¡ Python 3.11 ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— ---
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # --- â‘¢ ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ---
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install -r requirements.txt
          python -m pip install -e vendor/windsurf   # â† vendor ç‰ˆ WindSurf ã‚’ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã§

      # --- â‘£ WindSurf ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œ ---
      - name: Run WindSurf pipeline
        env:
          OPENAI_API_KEY:             ${{ secrets.OPENAI_API_KEY }}
          GOOGLE_APPLICATION_CREDENTIALS: ${{ secrets.SA_JSON_PATH }}
          SPREADSHEET_ID:             ${{ secrets.SPREADSHEET_ID }}
          WP_URL:                     ${{ secrets.WP_URL }}
          WP_USER:                    ${{ secrets.WP_USER }}
          WP_APP_PASS:                ${{ secrets.WP_APP_PASS }}
          SLACK_WEBHOOK_URL:          ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          echo "ğŸ running WindSurf pipeline..."
          python run_pipeline.py